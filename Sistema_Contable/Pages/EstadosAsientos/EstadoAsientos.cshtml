@page
@model Sistema_Contable.Pages.EstadosAsientos.EstadoAsientoModel
@{
    ViewData["Title"] = "Estados de Asiento";
}

<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Estados de Asiento</h1>
    <a asp-page="./EstadoAsientosCrear" class="btn btn-primary btn-sm shadow-sm">
        <i class="fas fa-plus fa-sm text-white-50"></i> Añadir
    </a>
</div>

@if (TempData["Success"] is string ok)
{
    <div class="alert alert-success">@ok</div>
}
@if (TempData["Error"] is string err)
{
    <div class="alert alert-danger">@err</div>
}

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Listado</h6>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Nombre</th>
                        <th>Descripción</th>
                        <th style="width:150px;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var e in Model.Estados)
                    {
                        <tr>
                            <td>@e.Codigo</td>
                            <td>@e.Nombre</td>
                            <td>@e.Descripcion</td>
                            <td class="text-center">
                                <a asp-page="./EstadoAsientosEditar" asp-route-codigo="@e.Codigo"
                                   class="btn btn-primary btn-sm">
                                    <i class="fas fa-edit"></i>
                                </a>

                                <button type="button"
                                        class="btn btn-danger btn-sm ml-1 btn-eliminar"
                                        data-id="@e.Codigo"
                                        data-nombre="@e.Nombre">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- Modal Eliminar Estado Asiento -->
<div class="modal fade" id="modalEliminar" tabindex="-1" role="dialog"
     aria-labelledby="modalEliminarLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">

            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="modalEliminarLabel">
                    Confirmar eliminación
                </h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>
                    ¿Seguro que deseas eliminar el estado
                    <strong id="estadoNombre"></strong>?
                </p>

                @if (!string.IsNullOrWhiteSpace(Model.MensajeModal))
                {
                    <div class="alert alert-danger mt-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        @Model.MensajeModal
                    </div>
                }
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    Cancelar
                </button>

                <form method="post" asp-page-handler="Eliminar">
                    <input type="hidden" id="codigoEliminar" name="codigo" />
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Sí, eliminar
                    </button>
                </form>
            </div>

        </div>
    </div>
</div>
@section Scripts {
    <script>
            $(document).ready(function () {
            $('#dataTable').DataTable();

            $('.btn-eliminar').on('click', function () {
                var codigo = $(this).data('id');
                var nombre = $(this).data('nombre');

                $('#codigoEliminar').val(codigo);
                $('#estadoNombre').text(nombre);

                $('#modalEliminar').modal('show');
            });


            var mostrar = '@Model.MostrarModal'.toLowerCase() === 'true';
            if (mostrar) {
                $('#codigoEliminar').val('@Model.CodigoModal');
                $('#estadoNombre').text('@Model.NombreModal');
                $('#modalEliminar').modal('show');
            }
        });
    </script>
}
